#!/bin/bash

CURRENT_DIR=$PWD

if [[ -z "$ROS_DISTRO" ]]; then
  echo "ROS is not installed, please install ROS first."
  exit 1
fi

echo "Enter desired EAGERx root install location. If it does not exist, it will be created."
echo "Press enter for default: ${HOME}"
read input
if [[ ! ${#input} -ge 1  ]]; then
  EAGERX_ROOT=${HOME}
elif [[ ! -d $input ]]; then
  mkdir -p $input
  EAGERX_ROOT=${input}
else
  EAGERX_ROOT=${input}
fi

EAGERX_HOME=${EAGERX_ROOT}/eagerx

if [ ! -d ${EAGERX_HOME} ]; then
  cd ${EAGERX_ROOT}
  echo Cloning EAGERx...
  git clone https://github.com/eager-dev/eagerx.git
fi

cd $CURRENT_DIR

echo "Enter desired location of EAGERx workspace. If it does not exist, it will be created."
echo "Press enter for default: ${HOME}/eagerx_ws"
input=0
read input
if [[ ! ${#input} -ge 1  ]]; then
  EAGERX_WS=${HOME}/eagerx_ws
elif [[ ! -d $input ]]; then
  mkdir -p ${input}/src
  EAGERX_WS=${input}
else
  if [[ ! -d $input/src ]]; then
    mkdir -p ${input}/src
  fi
  EAGERX_WS=${input}
fi

if [ ! -d ${EAGERX_WS} ]; then
  echo "Creating EAGERx workspace"
  mkdir -p ${EAGERX_WS}/src
  cd ${EAGERX_WS}/src
  ln -s ${EAGERX_HOME}/eagerx_core
fi

if [ ! -d ${EAGERX_WS}/src/eagerx_core ]; then
  cd ${EAGERX_WS}/src
  ln -s ${EAGERX_HOME}/eagerx_core
fi

cd ${EAGERX_WS}
rosdep update --rosdistro $ROS_DISTRO
rosdep install --from-paths src --ignore-src -r -y
catkin_make
