# Check if ROS is installed
if [[ -z "$ROS_DISTRO" ]]; then
  exit 1
fi

# Check if OpenDR is installed
if [[ -z "$OPENDR_HOME" ]]; then
  exit 1
fi

EAGERX_ROOT=${OPENDR_HOME}/projects/control
EAGERX_WS=${OPENDR_HOME}/projects/eagerx_ws

# Check if EAGERx repo is already cloned
if [ ! -d ${EAGERX_ROOT}/eagerx ]; then
  cd ${EAGERX_ROOT}
  git clone https://github.com/eager-dev/eagerx.git
fi

# Check if eagerx_ws already exists
if [ ! -d ${EAGERX_WS} ]; then
  mkdir -p ${EAGERX_WS}/src
fi

# Check if eagerx_core is already linked
if [ ! -d ${EAGERX_WS}/src/eagerx_core ]; then
  cd ${EAGERX_WS}/src
  ln -s ${EAGERX_ROOT}/eagerx/eagerx_core
fi

# Build eagerx_ws
cd ${EAGERX_WS}
rosdep update --rosdistro $ROS_DISTRO
rosdep install --from-paths src --ignore-src -r -y
catkin_make
